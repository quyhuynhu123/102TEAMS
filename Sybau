local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")

-- üßπ Xo√° GUI l·∫°
for _, gui in ipairs(PlayerGui:GetChildren()) do
    if gui:IsA("ScreenGui") and gui:FindFirstChildWhichIsA("TextLabel", true) then
        if string.find(gui:FindFirstChildWhichIsA("TextLabel", true).Text, "Script Loading Please Wait!") then
            gui:Destroy()
        end
    end
end

-- üì¶ D·ªØ li·ªáu pet theo t·ª´ng lo·∫°i tr·ª©ng
local eggPetData = {
    ["Common Egg"] = {
        {Name = "Dog", Weight = 3},
        {Name = "Golden Lad", Weight = 2},
        {Name = "Bunny", Weight = 3},
    },
    ["Uncommon Egg"] = {
        {Name = "Deer", Weight = 3},
        {Name = "Cat", Weight = 3},
        {Name = "Chicken", Weight = 3},
    },
    ["Rare Egg"] = {
        {Name = "Cow", Weight = 3},
        {Name = "Sheep", Weight = 3},
        {Name = "Goat", Weight = 3},
    },
    ["Bug Egg"] = {
        {Name = "Snail", Weight = 3},
        {Name = "Caterpillar", Weight = 3},
        {Name = "Mantis", Weight = 3},
        {Name = "Giant Ant", Weight = 3},
        {Name = "Dragonfly", Weight = 1},
    },
    ["Zen Egg"] = {
        {Name = "Shiba Inu", Weight = 3},
        {Name = "Kappa", Weight = 3},
        {Name = "Kitsune", Weight = 1},
        {Name = "Tanuki", Weight = 3},
        {Name = "Nihonzaru", Weight = 3},
    },
    ["Mythical Egg"] = {
        {Name = "Red Fox", Weight = 1},
        {Name = "Grey Mouse", Weight = 3},
        {Name = "Squirrel", Weight = 3},
    },
    ["Legendary Egg"] = {
        {Name = "Polar Bear", Weight = 1},
        {Name = "Turtle", Weight = 3},
        {Name = "Elephant", Weight = 3},
        {Name = "Leopard", Weight = 3},
    },
    ["Dinosaur Egg"] = {
        {Name = "T-Rex", Weight = 1},
        {Name = "Stegosaurus", Weight = 3},
        {Name = "Triceratops", Weight = 3},
        {Name = "Pterodactyl", Weight = 3},
    },
    ["Rainbow Egg"] = {
        {Name = "Unicorn", Weight = 2},
        {Name = "Rainbow Cat", Weight = 2},
        {Name = "Pegasus", Weight = 2},
        {Name = "Glitter Deer", Weight = 2},
    },
}

-- üß≤ H√†m ch·ªçn pet theo t·ªâ l·ªá
local function chooseWeightedPet(pets)
    local totalWeight = 0
    for _, pet in ipairs(pets) do
        totalWeight += pet.Weight
    end
    local rand = math.random() * totalWeight
    local cumulative = 0
    for _, pet in ipairs(pets) do
        cumulative += pet.Weight
        if rand <= cumulative then
            return pet.Name
        end
    end
end

-- üîç L·∫•y t·∫•t c·∫£ tr·ª©ng trong ph·∫°m vi 50 studs
local function getNearbyEggs()
    local eggsInRange = {}
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("Model") and eggPetData[obj.Name] and obj:FindFirstChild("PrimaryPart") then
            if (obj.PrimaryPart.Position - player.Character.PrimaryPart.Position).Magnitude <= 50 then
                table.insert(eggsInRange, obj)
            end
        end
    end
    return eggsInRange
end

-- üé≤ Random v√† hi·ªÉn th·ªã t√™n pet
local lastUsed = 0
local function randomize()
    if tick() - lastUsed < 5 then return end
    lastUsed = tick()
    for _, egg in ipairs(getNearbyEggs()) do
        local petName = chooseWeightedPet(eggPetData[egg.Name])
        local label = egg:FindFirstChild("PetLabel")
        if not label then
            label = Instance.new("BillboardGui", egg)
            label.Name = "PetLabel"
            label.Size = UDim2.new(0, 200, 0, 50)
            label.StudsOffset = Vector3.new(0, 3, 0)
            label.AlwaysOnTop = true
            local text = Instance.new("TextLabel", label)
            text.Size = UDim2.new(1, 0, 1, 0)
            text.BackgroundTransparency = 1
            text.TextColor3 = Color3.new(1, 1, 1)
            text.TextScaled = true
            text.Font = Enum.Font.GothamBold
        end
        label.TextLabel.Text = petName
    end
end

-- üñ•Ô∏è GUI
local gui = Instance.new("ScreenGui", PlayerGui)
gui.Name = "PetRandomizerUI"
gui.ResetOnSpawn = false

local mainFrame = Instance.new("Frame", gui)
mainFrame.Size = UDim2.new(0, 250, 0, 100)
mainFrame.Position = UDim2.new(0.5, -125, 0.5, -50)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.BorderSizePixel = 0
mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
mainFrame.Draggable = true
mainFrame.Active = true

local toggleButton = Instance.new("TextButton", mainFrame)
toggleButton.Size = UDim2.new(0, 30, 0, 30)
toggleButton.Position = UDim2.new(1, -35, 0, 5)
toggleButton.Text = "-"
toggleButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
toggleButton.TextColor3 = Color3.new(1, 1, 1)

local randomButton = Instance.new("TextButton", mainFrame)
randomButton.Size = UDim2.new(0, 200, 0, 40)
randomButton.Position = UDim2.new(0.5, -100, 0.5, -20)
randomButton.Text = "Random Pet"
randomButton.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
randomButton.TextColor3 = Color3.new(1, 1, 1)
randomButton.Font = Enum.Font.GothamBold
randomButton.TextScaled = true

randomButton.MouseButton1Click:Connect(randomize)

toggleButton.MouseButton1Click:Connect(function()
    mainFrame.Visible = false
    wait(0.2)
    toggleButton.Parent = gui
    toggleButton.Position = UDim2.new(0, 10, 0, 10)
end)

toggleButton.MouseButton1Click:Connect(function()
    if mainFrame.Visible then
        mainFrame.Visible = false
    else
        mainFrame.Visible = true
        toggleButton.Parent = mainFrame
        toggleButton.Position = UDim2.new(1, -35, 0, 5)
    end
end)
